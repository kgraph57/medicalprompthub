# トークン化とコンテキストウィンドウ

## 🎯 このレッスンで学ぶこと

このレッスンを完了すると、トークン化の仕組みとコンテキストウィンドウの概念を理解し、生成AIがテキストをどのように処理するかを把握できるようになります。医療文書での実践的な影響も学びます。

---

## 📖 セクション1: トークン化とは何か

### テキストの分割

トークン化（Tokenization）は、テキストを小さな単位（トークン）に分割する処理です。AIは、テキストを直接理解するのではなく、トークンという単位で処理します。

**トークンの種類**：

トークン化には主に3つの方法があります。単語単位では、各単語が1つのトークンとなります（例：「患者」「診断」）。部分単語単位では、単語をさらに小さく分割します（例：「診断」→「診」「断」）。文字単位では各文字が1つのトークンとなりますが、この方法はあまり使われません。現在のLLMでは、部分単語単位のトークン化が主流です。

### 医療用語のトークン化

医療用語は、一般的な単語よりも長く、複雑な場合があります。

**例**：

医療用語のトークン化では、例えば「急性心筋梗塞」は複数のトークンに分割される可能性があります。「2型糖尿病」の場合、「2」「型」「糖尿病」などに分割されることがあります。この分割方法は、AIの理解に影響を与えるため、医療用語のトークン化には注意が必要です。

**重要な理解**：
トークン化の方法によって、AIの理解が変わる可能性があります。医療用語を適切にトークン化することは、正確な理解に重要です。

---

## 📖 セクション2: コンテキストウィンドウ

### 一度に処理できる情報量

コンテキストウィンドウは、AIが一度に処理できるトークン数の上限です。

**コンテキストウィンドウのサイズ**：
- **GPT-3.5**：約4,000トークン
- **GPT-4**：約8,000〜32,000トークン（モデルによって異なる）
- **Claude 3**：約200,000トークン
- **Gemini**：約1,000,000トークン

### 医療文書での影響

医療文書は、しばしば長くなります。症例報告書や診療記録は、数千から数万トークンになる場合があります。

**実践的な影響**：

医療文書を処理する際、コンテキストウィンドウを超える場合は分割が必要になります。そのため、情報の優先順位を考え、重要な情報を最初に配置することが重要です。また、長い文書を要約してから処理するという方法も有効です。これらの工夫により、コンテキストウィンドウの制限を効果的に活用できます。

---

## 📖 セクション3: トークン数の見積もり

### 日本語と英語の違い

日本語と英語では、トークン化の方法が異なります。

**一般的な目安**：

トークン数の見積もりでは、英語では1単語が約1.3トークンに相当します。日本語では1文字が約0.5〜1トークン（文字の種類による）となります。この違いは、言語の特性によるものです。

**医療文書での例**：

医療文書での具体的な例を見ると、短い診断書（500文字）は約250〜500トークン、症例報告書（5,000文字）は約2,500〜5,000トークン、長い診療記録（20,000文字）は約10,000〜20,000トークンとなります。これらの見積もりは、コンテキストウィンドウの使用計画を立てる際に役立ちます。

### トークン数の確認方法

多くのAIツールでは、トークン数を確認できます。

**確認方法**：

トークン数の確認方法としては、ChatGPTでは入力テキストの文字数から概算できます。Claudeではトークン数を表示してくれるため、より正確に把握できます。APIを使用する場合は、トークン数を正確に計算できます。これらの方法を活用することで、コンテキストウィンドウの使用状況を適切に管理できます。

---

## 📖 セクション4: コンテキストウィンドウの最適化

### 効率的な情報の配置

コンテキストウィンドウを効率的に使うためには、情報の配置が重要です。

**ベストプラクティス**：

コンテキストウィンドウを効率的に使うためには、診断名、主訴など重要な情報を最初に配置することが重要です。また、冗長な情報は削除し、情報を構造化して理解しやすくすることで、AIの処理効率が向上します。これらの工夫により、限られたコンテキストウィンドウを最大限に活用できます。

### 長い文書の処理

コンテキストウィンドウを超える長い文書を処理する場合の方法：

**方法1：分割**：
- 文書を複数の部分に分割
- 各部分を個別に処理
- 結果を統合

**方法2：要約**：
- 長い文書を要約
- 要約版を処理
- 必要に応じて詳細を参照

**方法3：重要な部分の抽出**：
- 重要な部分のみを抽出
- 抽出した部分を処理

---

## 💡 重要な洞察：コンテキストの重要性

コンテキストウィンドウは、AIの能力を大きく左右します。大きなコンテキストウィンドウを持つAIは、より長い文書を理解し、より一貫性のある出力を生成できます。

**医療現場での重要性**：

医療現場では、長い診療記録を一度に処理できるという点が重要です。また、文書全体の一貫性を保てるため、より正確な分析が可能になります。さらに、より詳細な分析が可能になることで、診断や治療の質が向上します。これらの利点により、大きなコンテキストウィンドウは医療現場でのAI活用において重要な要素となっています。

---

## 🎓 まとめ：トークン化とコンテキストウィンドウを理解する

このレッスンでは、トークン化とコンテキストウィンドウについて学びました。

**重要なポイント**：

このレッスンで学んだ重要なポイントを振り返ると、まずトークン化はテキストを小さな単位に分割する処理です。コンテキストウィンドウは一度に処理できるトークン数の上限を示します。医療文書での影響として、長い文書の処理方法を理解することが重要です。最適化の観点から、効率的な情報の配置と処理方法を学ぶことで、AIをより効果的に活用できるようになります。

### 次のステップ

次のレッスンでは、生成プロセスとサンプリングについて学びます。AIがどのようにテキストを生成するかを理解します。

---

**更新日**: 2025年12月
