# レッスン4: 効果的なプロンプトの書き方 - Cursor IDEでのコード生成

## 1. はじめに

Cursor IDEで高品質なコードを生成するには、適切なプロンプト（指示）を書くことが不可欠です。本レッスンでは、Cursor IDEのAI機能を最大限に活用するための効果的なプロンプトの書き方について、医療現場でのコーディング例を交えながら詳しく学びます。

プロンプトの書き方一つで、生成されるコードの質は大きく変わります。単に「コードを書いて」と指示するのではなく、何を作りたいのか、どのような条件があるのか、どのような形式で書いてほしいのかを明確に伝えることで、より実用的なコードを生成できます。

## 2. 効果的なプロンプトの基本原則

### 明確性：何をしたいかを明確に

効果的なプロンプトの第一原則は、明確性です。曖昧な指示は曖昧なコードしか生みません。

**不適切なプロンプト例：**

```
患者データを処理する関数を作って
```

このプロンプトは、何を処理するのか、どのように処理するのかが不明確です。

**改善されたプロンプト例：**

```
Pythonで、患者の年齢、性別、検査値（血糖値、HbA1c）を受け取り、
糖尿病のリスクを評価する関数を作成してください。

- 血糖値が126mg/dL以上、またはHbA1cが6.5%以上の場合は「高リスク」
- 血糖値が100-125mg/dL、またはHbA1cが5.7-6.4%の場合は「中リスク」
- それ以外は「低リスク」
として返してください。

関数名は `evaluate_diabetes_risk` とし、docstringを日本語で書いてください。
```

### 具体性：詳細な要件を指定

具体的な要件を指定することで、より実用的なコードが生成されます。

**具体性を高めるポイント：**

- **入力と出力の形式**: どのような形式でデータを受け取り、どのような形式で返すか
- **エラーハンドリング**: エラーが発生した場合の処理
- **コメント**: どのようなコメントが必要か（日本語か英語か）

**医療現場での例：**

```
Pythonで、患者の診断情報を管理するクラスを作成してください。

要件：
- 患者ID、診断名、診断日を格納
- 診断名を追加するメソッド
- 特定の診断名を持つかチェックするメソッド
- 診断履歴を時系列で返すメソッド
- データの整合性チェック（患者IDは文字列、診断日はdatetimeオブジェクト）
- エラー時は適切な例外を発生させる

クラス名は `DiagnosisManager` とし、docstringとコメントは日本語で記述してください。
```

### コンテキストの提供：背景情報を含める

関連するコードや既存の実装がある場合は、そのコンテキストを提供することで、より適切なコードが生成されます。

**コンテキストを含めたプロンプト例：**

```
既存のコード：
```python
class Patient:
    def __init__(self, patient_id, name, age):
        self.patient_id = patient_id
        self.name = name
        self.age = age
```

上記の `Patient` クラスを使用して、複数の患者の検査結果を管理するクラスを作成してください。
各患者の検査結果（検査名、値、検査日）を保存し、特定の検査結果を取得できるようにしてください。
```

## 3. 段階的なプロンプト：複雑なタスクの分解

### 大きなタスクを小さく分解

複雑な機能を一度に実装しようとすると、コードの質が下がることがあります。大きなタスクを小さなタスクに分解し、段階的に実装することで、より高品質なコードを生成できます。

**段階的なアプローチの例：**

**ステップ1：基本的な構造の作成**

```
Pythonで、患者データをCSVファイルから読み込む関数を作成してください。
- ファイル名を引数として受け取る
- pandasを使用してCSVを読み込む
- エラーハンドリングを含める（ファイルが存在しない場合など）
```

**ステップ2：データ処理の追加**

```
先ほどの関数を拡張して、読み込んだ患者データを前処理してください。
- 欠損値のある行を除外
- 異常値（年齢が0以下、200以上など）を除外
- 処理済みデータを返す
```

**ステップ3：統計情報の追加**

```
さらに拡張して、前処理後のデータの統計情報を表示する機能を追加してください。
- 平均年齢、性別の分布、検査値の統計を表示
```

## 4. 医療現場での実践例

### 診断支援スクリプトの作成

**プロンプト例：**

```
Pythonで、患者の症状から鑑別診断を提案する関数を作成してください。

要件：
- 入力：患者の年齢、性別、主訴、症状（リスト）、既往歴（リスト）
- 出力：可能性のある診断名とその確率（簡易的なスコア）のリスト
- 年齢や性別を考慮した診断（例：若年男性の心筋梗塞は低確率）
- 症状の組み合わせから、関連する疾患を検索する機能

実装方針：
- シンプルなルールベースのアプローチで実装
- 拡張しやすい構造にする
- 各診断の根拠となる症状も返す

関数名は `suggest_differential_diagnosis` とし、
docstringで使用例も含めてください。
```

### データ可視化スクリプトの作成

**プロンプト例：**

```
Pythonで、患者の検査値の推移を可視化する関数を作成してください。

要件：
- matplotlibまたはseabornを使用
- 入力：患者ID、検査項目名、期間（開始日、終了日）
- グラフ：折れ線グラフで検査値の推移を表示
- 基準値範囲を色付きで表示（正常範囲、注意範囲）
- グラフのタイトル、軸ラベルを日本語で表示
- ファイルに保存する機能も含める

関数名は `plot_test_trend` とし、
スタイルは医療現場で使用しやすいクリアで読みやすいものにしてください。
```

### 診療録の自動生成スクリプト

**プロンプト例：**

```
Pythonで、患者の情報から診療録のテンプレートを生成する関数を作成してください。

要件：
- 入力：患者情報（辞書形式）、診断、処方薬、検査項目
- 出力：SOAP形式（Subjective, Objective, Assessment, Plan）の診療録テキスト
- テンプレートは日本語で、医療現場で使用される標準的な形式
- オプションで、追加のコメントや注意事項を記載できるようにする

関数名は `generate_clinical_note` とし、
出力は読みやすく整形されたテキスト（改行を含む）にしてください。
```

## 5. プロンプトの改善テクニック

### 反復的な改善：生成コードを基に再指示

最初の生成コードが完璧でない場合でも、それを基に改善を指示することで、より良いコードを得られます。

**改善プロンプト例：**

```
生成されたコードを確認しました。以下の点を改善してください：

1. エラーハンドリングをより詳細にする（具体的なエラーメッセージを返す）
2. パフォーマンスを向上させる（データ量が多い場合を考慮）
3. コメントを追加して、各処理の意図を明確にする
4. 型ヒントを追加する

既存のコード構造は維持しつつ、上記の改善を行ってください。
```

### 参考コードの提供：既存のコードスタイルに合わせる

既存のコードベースがある場合、そのスタイルに合わせたコードを生成するために、参考コードを提供します。

**プロンプト例：**

```
既存のコードスタイル：
```python
def process_data(data: List[Dict]) -> pd.DataFrame:
    """データを処理してDataFrameに変換する
    
    Args:
        data: 処理するデータのリスト
        
    Returns:
        処理済みのDataFrame
    """
    ...
```

このスタイルに合わせて、患者データを処理する関数を作成してください。
```

## 6. よくある間違いと回避方法

### 曖昧な指示

**間違い例：**
```
良いコードを書いて
```

**正しい例：**
```
医療データを分析する関数を作成してください。具体的には...
```

### 技術的な詳細の不足

**間違い例：**
```
データを処理して
```

**正しい例：**
```
pandasを使用して、CSVファイルから患者データを読み込み、
欠損値を処理して、統計情報を計算してください。
```

### テスト要件の省略

**改善例：**
```
上記の関数を作成し、以下のテストケースが通ることを確認してください：
- 正常なデータでの動作
- 欠損値がある場合の処理
- エッジケース（空のデータなど）
```

## 7. まとめ

本レッスンでは、Cursor IDEで効果的なプロンプトを書く方法について学びました。明確性、具体性、コンテキストの提供が重要であり、複雑なタスクは段階的に分解することで、より高品質なコードを生成できます。

医療現場でのコーディングでは、安全性、正確性、可読性が特に重要です。これらの点をプロンプトに明示することで、より実用的なコードが生成されます。

次のレッスンでは、Cursor IDEでのデバッグとテストについて詳しく学びます。生成されたコードを適切にテストし、バグを修正する方法を理解していきましょう。

---

### 参考資料

- [Cursor IDE Documentation](https://cursor.sh/docs): Cursor IDEの公式ドキュメント
- [GitHub Copilot Documentation](https://docs.github.com/en/copilot): GitHub Copilotのドキュメント（プロンプトの書き方の参考）
