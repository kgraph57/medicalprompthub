# レッスン2: 医療におけるプロンプトエンジニアリング

## 1. はじめに

大規模言語モデル（LLM）は非常に強力なツールですが、その性能を最大限に引き出すためには、適切な「指示」を与えることが不可欠です。この指示を設計する技術が**プロンプトエンジニアリング**です。本レッスンでは、LLMとの対話の質を劇的に向上させるプロンプトエンジニアリングの基本原則と、医療現場で特に有効なテクニックについて学びます。

## 2. プロンプトエンジニアリングの基本原則

効果的なプロンプトを作成するためには、いくつかの基本原則があります。これらは、LLMにこちらの意図を正確に伝え、期待する出力を得るための土台となります。

- **明確かつ具体的であること**: 曖昧な指示は曖昧な答えしか生みません。「高血圧について教えて」ではなく、「成人の本態性高血圧の初期治療における第一選択薬について、最新のガイドラインに基づき説明してください」のように、具体的かつ詳細に指示します。
- **コンテキスト（文脈）を提供する**: LLMが応答を生成するために必要な背景情報を提供します。患者の年齢、性別、症状、既往歴などを提供することで、より臨床的に適切な回答が得られます。
- **役割（ペルソナ）を与える**: 「あなたは経験豊富な循環器専門医です」のように役割を指定することで、LLMはその役割になりきり、専門的な視点から一貫性のある応答を生成しようとします。
- **望ましい出力形式を指定する**: 回答の形式を具体的に指示します。例えば、「箇条書きで」「表形式で」「500字以内で」といった指定が有効です。

## 3. 医療で役立つ主要なプロンプティング技術

基本原則に加え、より高度な応答を引き出すための代表的なテクニックを3つ紹介します。

### Zero-shotプロンプティング

これは、タスクの例を一切示さずに、LLMに直接指示を与える最もシンプルな方法です。LLMが既に学習している一般的な知識を問う場合に有効です。

**プロンプト例:**
```
インスリンの主な副作用を3つ挙げてください。
```

### Few-shotプロンプティング

Few-shotプロンプティングでは、いくつかの「例（ショット）」をプロンプトに含めることで、LLMに期待する応答のパターンを学習させます。これにより、より複雑なタスクや特定のフォーマットでの出力が可能になります。

**プロンプト例:**
```
患者の訴えをSOAP形式のカルテに要約するタスクです。

# 例1
患者の訴え: 「3日前から喉が痛くて、熱も38度あります。咳も出ます。」
SOAP形式の要約:
S: 3日前からの咽頭痛、38度の発熱、咳嗽あり。
O: (診察所見を記載)
A: 急性上気道炎の疑い
P: (治療計画を記載)

# 例2
患者の訴え: 「昨日、転んで足首をひねりました。すごく腫れていて痛いです。」
SOAP形式の要約:
S: 昨日、転倒し右足関節を捻挫。著明な腫脹と疼痛あり。
O: (診察所見を記載)
A: 右足関節捻挫
P: (治療計画を記載)

# 本番
患者の訴え: 「1週間前から胸が締め付けられるような感じがします。特に階段を上る時にひどくなります。」
SOAP形式の要約:
```

### Chain-of-Thought (CoT) プロンプティング

Chain-of-Thought（思考の連鎖）は、複雑な推論が必要な問題に対して、LLMに「思考のプロセスを段階的に説明させる」ことで、最終的な回答の精度を向上させる技術です [1]。特に、診断推論のような多段階の思考を要するタスクで非常に有効です。

**プロンプト例:**
```
あなたは経験豊富な総合内科医です。以下の患者情報に基づき、鑑別診断を3つ挙げ、その思考プロセスを段階的に説明してください。

# 患者情報
- 55歳、男性
- 主訴: 2時間前から持続する胸痛
- 現病歴: 胸部中央が締め付けられるような痛み。左肩に放散痛あり。冷や汗も伴う。
- 既往歴: 高血圧、脂質異常症
- 喫煙歴: 20本/日を30年間

ステップバイステップで考えてください。
```
このプロンプトにより、LLMはまず「胸痛をきたす疾患は何か」を考え、次に「患者のリスク因子は何か」を考慮し、最終的に「最も可能性の高い診断は何か」というように、論理的な思考プロセスを経て回答を生成します。

## 4. 医療コンテキストに合わせたプロンプト設計

医療現場でLLMを安全かつ効果的に使用するためには、プロンプトに含めるべき情報と、その際の注意点を理解しておく必要があります。

- **患者情報の構造化**: 患者の情報を漫然と記述するのではなく、「年齢」「性別」「主訴」「現病歴」「既往歴」「内服薬」「アレルギー歴」のように項目を立てて構造化することで、LLMは情報を正確に認識しやすくなります。
- **個人情報の保護**: 患者の氏名、ID、住所などの個人を特定できる情報は、プロンプトに含めてはいけません。必ず匿名化、あるいはマスキングした情報を使用してください。

## 5. まとめ

プロンプトエンジニアリングは、LLMという強力なエンジンを意のままに操るための「運転技術」です。本レッスンで学んだ基本原則とテクニックを組み合わせ、試行錯誤を繰り返すことで、先生方の臨床、研究、教育における強力なアシスタントとしてLLMを育てていくことができます。

次のレッスンでは、LLMの回答の信頼性を飛躍的に向上させる**RAG（Retrieval-Augmented Generation）**という技術について学び、最新の医療情報をLLMに組み込む方法を探求します。

---

### 参考文献

[1] Wei, J., Wang, X., Schuurmans, D., Bosma, M., Ichter, B., Xia, F., ... & Zhou, D. (2022). Chain-of-thought prompting elicits reasoning in large language models. In *Advances in Neural Information Processing Systems*, *35*, 6033-6047.
