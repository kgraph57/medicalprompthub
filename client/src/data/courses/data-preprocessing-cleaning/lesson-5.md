# 特徴量エンジニアリング

## このレッスンで学ぶこと

このレッスンでは、特徴量エンジニアリングの方法を学びます。
生のデータから、モデルの性能を向上させる特徴量を作成する方法を習得します。

---

## セクション1: 特徴量エンジニアリングとは

### 特徴量エンジニアリングの定義

特徴量エンジニアリングとは、生のデータから、モデルの性能を向上させる特徴量を作成するプロセスです。

目的：
- モデルの性能を向上させる
- データの意味を明確にする
- 計算効率を向上させる

### なぜ重要なのか

特徴量エンジニアリングは、モデルの性能に大きな影響を与えます。

- 良い特徴量 → 高い性能
- 悪い特徴量 → 低い性能

「データと特徴量がすべて。アルゴリズムは重要ではない」という言葉もあるほどです。

---

## セクション2: 特徴量の作成方法

### 方法1: 数値特徴量の変換

#### 対数変換

歪んだ分布を正規分布に近づけます。

適用条件：
- データが右に歪んでいる
- 外れ値が多い

例：
- 検査値の対数変換
- 薬物投与量の対数変換

#### 多項式特徴量

変数のべき乗を作成します。

例：
- x², x³ などの特徴量
- 非線形関係を捉える

### 方法2: カテゴリカル特徴量の変換

#### ワンホットエンコーディング

カテゴリカル変数をバイナリ変数に変換します。

例：
- 診断名 → 複数のバイナリ変数
- 薬剤名 → 複数のバイナリ変数

#### ターゲットエンコーディング

カテゴリの平均値を特徴量として使用します。

例：
- 診断名ごとの平均検査値
- 薬剤ごとの平均効果

### 方法3: 時系列特徴量の作成

#### ラグ特徴量

過去の値を特徴量として使用します。

例：
- 前回の検査値
- 前回の診断結果

#### 移動平均

時系列データの移動平均を計算します。

例：
- 過去7日間の平均
- 過去30日間の平均

---

## セクション3: 医療データでの実践例

### 例1: 検査値の特徴量作成

血液検査データから特徴量を作成します。

作成する特徴量：
- **比率**: 各検査値の比率（例：AST/ALT比）
- **変化率**: 前回からの変化率
- **異常フラグ**: 正常範囲外かどうか

効果：
- モデルの性能向上
- 臨床的な意味が明確

### 例2: 診療録テキストの特徴量作成

診療録テキストから特徴量を作成します。

作成する特徴量：
- **キーワードの出現頻度**: 重要な単語の出現回数
- **文書の長さ**: 文字数、単語数
- **感情スコア**: ポジティブ/ネガティブのスコア

効果：
- テキストデータを数値データに変換
- モデルで処理可能に

---

## セクション4: 特徴量の選択

### 特徴量選択の重要性

不要な特徴量は、モデルの性能を低下させます。

問題：
- 過学習のリスク
- 計算コストの増加
- 解釈の困難さ

### 選択方法

#### 相関分析

目的変数との相関が高い特徴量を選択します。

- 相関係数の計算
- 閾値以上の特徴量を選択

#### 特徴量重要度

モデルの特徴量重要度を使用します。

- ランダムフォレストの重要度
- 勾配ブースティングの重要度

#### 正則化

L1正則化により、不要な特徴量を削除します。

- Lasso回帰
- 特徴量の自動選択

---

## セクション5: ベストプラクティス

### 原則1: ドメイン知識を活用する

医療の専門知識を活用して特徴量を作成します。

- 臨床的な意味を考慮
- 専門家の意見を聞く
- 医学文献を参考にする

### 原則2: 段階的に作成する

一度にすべてを作成せず、段階的に進めます。

1. 基本的な特徴量を作成
2. モデルの性能を評価
3. 追加の特徴量を作成
4. 再評価

### 原則3: 検証データで評価する

特徴量の効果は、検証データで評価します。

- 訓練データでの性能は参考程度
- 検証データでの性能が重要
- 過学習に注意

---

## まとめ：特徴量エンジニアリングを理解する

このレッスンでは、特徴量エンジニアリングの方法を学びました。

重要なポイント：
1. 特徴量エンジニアリングはモデルの性能に大きな影響を与える
2. 数値、カテゴリカル、時系列データそれぞれに適した方法がある
3. 医療データではドメイン知識を活用する
4. 段階的に作成し、検証データで評価する

### 次のステップ

次のレッスンでは、前処理の実践的なワークフローを学びます。

---

更新日: 2025年12月

