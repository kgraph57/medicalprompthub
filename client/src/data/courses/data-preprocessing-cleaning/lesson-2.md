# 欠損値の処理

## このレッスンで学ぶこと

このレッスンを完了すると、欠損値の種類を理解し、適切な処理方法を選択できるようになります。
医療データにおける欠損値の特性を理解し、実践的な処理方法を習得します。

---

## セクション1: 欠損値とは何か

### 欠損値の定義

欠損値とは、データセットにおいて値が記録されていない、または記録できない項目のことです。

医療データでの欠損値の例：
- 検査が実施されていない
- 測定不能な値
- データ入力の漏れ
- 患者が来院しなかった

### 欠損値の影響

欠損値は、AIモデルの性能に大きな影響を与えます。

影響：
- 学習データの減少
- モデルの性能低下
- バイアスの発生
- 分析の精度低下

---

## セクション2: 欠損値の種類

### MCAR（Missing Completely At Random）

完全にランダムな欠損です。
欠損の発生が、観測された変数や欠損値自体に依存しません。

例：
- 検査機器の一時的な故障
- ランダムなデータ入力ミス

特徴：
- 欠損値の処理が比較的容易
- リストワイズ削除が適切な場合がある

### MAR（Missing At Random）

観測された変数に依存する欠損です。
欠損値自体には依存しませんが、他の観測変数に依存します。

例：
- 高齢者で特定の検査が実施されない
- 特定の疾患で検査が省略される

特徴：
- 観測された変数から欠損を予測可能
- 代入法が有効

### MNAR（Missing Not At Random）

欠損値自体に依存する欠損です。
欠損の発生が、欠損値の値に依存します。

例：
- 異常値が測定されない（測定不能）
- 患者が来院しない（症状が軽い/重い）

特徴：
- 処理が困難
- バイアスの発生に注意

---

## セクション3: 欠損値の処理方法

### 方法1: リストワイズ削除

欠損値がある行を完全に削除します。

適用条件：
- MCARの場合
- 欠損値が少ない場合
- データが十分にある場合

メリット：
- 実装が簡単
- バイアスが少ない（MCARの場合）

デメリット：
- データの損失
- サンプルサイズの減少

### 方法2: ペアワイズ削除

分析に使用する変数のみを考慮して削除します。

適用条件：
- 変数間の相関を分析する場合
- 欠損パターンが複雑な場合

### 方法3: 平均値・中央値・最頻値による代入

欠損値を統計量で置き換えます。

- **平均値代入**: 連続変数で使用
- **中央値代入**: 外れ値がある場合
- **最頻値代入**: カテゴリカル変数で使用

メリット：
- データの損失がない
- 実装が簡単

デメリット：
- 分散の過小評価
- バイアスの発生

### 方法4: 回帰による代入

他の変数から欠損値を予測して代入します。

適用条件：
- MARの場合
- 予測に使用する変数が利用可能

メリット：
- より正確な代入
- 変数間の関係を考慮

デメリット：
- 計算コストが高い
- 過学習のリスク

### 方法5: 多重代入法

複数の代入値を生成し、複数のデータセットを作成します。

適用条件：
- 不確実性を考慮したい場合
- 統計的推論が重要な場合

メリット：
- 不確実性を考慮
- より正確な推論

デメリット：
- 計算コストが高い
- 実装が複雑

---

## セクション4: 医療データでの実践例

### 例1: 血液検査データの欠損値処理

血液検査データでは、以下の処理が適切です：

1. **欠損パターンの確認**
   - どの項目で欠損が多いか
   - 欠損のパターンは何か

2. **処理方法の選択**
   - MCAR → リストワイズ削除
   - MAR → 回帰による代入
   - MNAR → 専門家と相談

3. **処理の実施**
   - 選択した方法で処理
   - 処理前後のデータを比較

### 例2: バイタルサインの欠損値処理

バイタルサインでは、以下の処理が適切です：

1. **時系列データの考慮**
   - 前後の値から補間
   - 時間的な傾向を考慮

2. **臨床的な妥当性の確認**
   - 代入値が臨床的に妥当か
   - 専門家の意見を聞く

---

## セクション5: ベストプラクティス

### 原則1: 欠損パターンを理解する

処理方法を選択する前に、欠損のパターンを十分に理解します。

- 欠損の発生率を確認
- 欠損のパターンを可視化
- 欠損の原因を調査

### 原則2: 複数の方法を試す

一つの方法に固執せず、複数の方法を試します。

- 異なる処理方法を比較
- モデルの性能を評価
- 最適な方法を選択

### 原則3: 処理の記録を残す

欠損値の処理手順を記録し、再現性を確保します。

- 処理方法を文書化
- 処理前後の統計量を記録
- コードを保存

---

## まとめ：欠損値の処理を理解する

このレッスンでは、欠損値の種類と処理方法を学びました。

重要なポイント：
1. 欠損値にはMCAR、MAR、MNARの3種類がある
2. 欠損値の種類に応じて処理方法を選択する
3. 医療データでは臨床的な妥当性を考慮する
4. 複数の方法を試して最適な方法を選択する

### 次のステップ

次のレッスンでは、外れ値の検出と処理方法を詳しく学びます。

---

更新日: 2025年12月

