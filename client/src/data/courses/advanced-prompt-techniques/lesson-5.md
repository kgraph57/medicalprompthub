# 高度なプロンプトの実践例

これまで学んだ高度なプロンプト技術（Chain-of-Thought、Few-shot Learning、RAG、マルチステッププロンプティング）を組み合わせて、医療分野での実践的な活用例を学びます。

## 実践例1: 複雑な診断支援

### シナリオ

65歳の男性患者が、胸痛と呼吸困難を主訴に来院。既往歴に高血圧、糖尿病あり。最新の診療ガイドラインと関連論文を参照しながら、段階的に診断を支援します。

### プロンプト設計

```
あなたは経験豊富な医師です。以下のマルチステッププロセスで診断を支援してください。

## ステップ1: 情報の整理と重要所見の抽出

患者情報:
- 65歳男性
- 主訴: 胸痛、呼吸困難（2時間前から）
- 既往歴: 高血圧、2型糖尿病
- 現病歴: 安静時にも胸痛が持続、左肩への放散痛あり
- バイタル: 血圧 150/90, 脈拍 110/分, 呼吸数 24/分, SpO2 94%
- 身体所見: 心音正常、呼吸音に軽度のラ音

重要な所見を抽出し、緊急性を評価してください。

## ステップ2: 鑑別診断の検討（Chain-of-Thought）

重要な所見に基づいて、以下の思考過程で鑑別診断を検討してください：

思考過程:
1. 主訴から考えられる主要な疾患カテゴリーは？
2. 各カテゴリーで、この患者に当てはまる疾患は？
3. 緊急性の高い疾患から優先的に検討

鑑別診断を、可能性の高い順にリストアップしてください。

## ステップ3: 最新ガイドラインの参照（RAG）

以下の最新の診療ガイドラインを参照してください：

[ガイドラインから検索された情報:
- 急性冠症候群の診断基準
- 心電図所見の解釈
- バイオマーカーの意義
- 治療アルゴリズム]

各鑑別診断について、ガイドラインに基づいて評価してください。

## ステップ4: 診断の絞り込みと治療方針

評価結果に基づいて：
1. 最も可能性の高い診断
2. 確信度（高/中/低）
3. 追加検査の推奨
4. 初期治療方針

を提示してください。
```

## 実践例2: 研究プロジェクトの設計

### シナリオ

AIを活用した糖尿病性網膜症の早期診断システムの研究を設計します。先行研究を参照しながら、段階的に研究設計を行います。

### プロンプト設計

```
あなたは医学研究の専門家です。以下のマルチステッププロセスで研究設計を支援してください。

## ステップ1: 研究課題の明確化

研究テーマ: AIを活用した糖尿病性網膜症の早期診断システムの開発

以下の観点から研究課題を明確化してください：
- 主要な研究質問（Primary Research Question）
- 副次的な研究質問（Secondary Research Questions）
- 研究の目的と意義
- 研究の新規性

## ステップ2: 先行研究の調査（RAG + Few-shot）

以下の先行研究を参照してください：

[PubMedから検索された関連論文:
- 論文1: [タイトルと要約]
- 論文2: [タイトルと要約]
- 論文3: [タイトルと要約]
- 論文4: [タイトルと要約]
- 論文5: [タイトルと要約]
]

以下の形式で先行研究を整理してください：

例:
- 研究: [研究名]
- 手法: [使用したAI手法]
- 結果: [主要な結果]
- 限界: [研究の限界]
- 本研究との違い: [本研究での改善点]

## ステップ3: 研究デザインの選択（Chain-of-Thought）

研究課題と先行研究の整理に基づいて、以下の思考過程で研究デザインを検討してください：

思考過程:
1. 研究の目的は何か？（探索的/記述的/説明的/評価的）
2. どのような研究デザインが適切か？
   - 観察研究 vs 介入研究
   - 横断研究 vs 縦断研究
   - 単一施設 vs 多施設
3. 各デザインの利点と限界は？
4. 本研究に最も適したデザインは？

推奨される研究デザインとその理由を説明してください。

## ステップ4: データ収集と分析計画

研究デザインに基づいて、以下を計画してください：

1. データ収集計画
   - 対象患者の定義（インクルージョン/エクスクルージョン基準）
   - 必要なサンプルサイズとその根拠
   - 収集するデータ項目
   - データの質管理

2. AIモデルの開発計画
   - 使用するAI手法
   - データの前処理
   - モデルの訓練と検証
   - 評価指標

3. 統計分析計画
   - 記述統計
   - モデルの性能評価
   - 感度・特異度などの診断精度指標
   - 多変量解析（必要に応じて）

## ステップ5: 研究の実施計画

研究を実施するための具体的な計画を立案してください：

- タイムライン（各フェーズの期間）
- 必要なリソース（人材、設備、予算）
- 倫理的配慮（IRB承認、インフォームドコンセント）
- リスク管理
```

## 実践例3: 症例報告の執筆支援

### シナリオ

稀な症例を報告する論文を執筆します。関連する症例報告を参照しながら、段階的に論文を構成します。

### プロンプト設計

```
あなたは医学論文執筆の専門家です。以下のマルチステッププロセスで症例報告の執筆を支援してください。

## ステップ1: 症例の要約と重要性の評価

以下の症例情報を整理してください：

症例情報:
[詳細な症例情報]

以下の観点から整理してください：
1. 症例の要約（時系列で）
2. この症例の重要性（なぜ報告する価値があるか）
3. 学習ポイント（読者が学べること）

## ステップ2: 関連症例の調査（RAG）

以下の関連症例報告を参照してください：

[PubMedから検索された関連症例報告:
- 症例1: [要約]
- 症例2: [要約]
- 症例3: [要約]
]

以下の形式で比較してください：

例:
- 症例: [症例名]
- 類似点: [本症例との類似点]
- 相違点: [本症例との相違点]
- 学び: [この症例から学べること]

## ステップ3: 論文の構成案（Few-shot）

以下の良い症例報告の構成を参考に、本症例の構成案を作成してください：

良い構成の例:
1. Introduction
   - 疾患の背景
   - 症例報告の目的
2. Case Presentation
   - 患者情報
   - 主訴と現病歴
   - 身体所見と検査所見
   - 診断と治療経過
3. Discussion
   - 症例の特徴
   - 関連症例との比較
   - 診断のポイント
   - 治療の考察
   - 学習ポイント
4. Conclusion
   - まとめ
   - 今後の展望

本症例の構成案を作成してください。

## ステップ4: 各セクションの執筆（Chain-of-Thought）

構成案に基づいて、各セクションを以下の思考過程で執筆してください：

### Introduction
思考過程:
1. この疾患の一般的な背景は？
2. なぜこの症例が重要か？
3. 読者に何を伝えたいか？

### Case Presentation
思考過程:
1. 時系列で重要な情報は？
2. 診断に重要な所見は？
3. どのように診断に至ったか？

### Discussion
思考過程:
1. この症例の特徴は？
2. 関連症例とどう違うか？
3. 診断のポイントは？
4. 治療の考察は？
5. 読者が学べることは？

各セクションを執筆してください。

## ステップ5: 内容の統合と改善

執筆した各セクションを統合し、以下を確認してください：

1. 論理的な流れ
2. 一貫性
3. 重要な情報の欠落
4. 改善点

統合された論文を提示し、改善点があれば指摘してください。
```

## 実践例4: 診療ガイドラインの解釈と適用

### シナリオ

最新の診療ガイドラインを参照しながら、具体的な患者ケースに適用する方法を検討します。

### プロンプト設計

```
あなたは臨床意思決定の専門家です。以下のマルチステッププロセスでガイドラインの適用を支援してください。

## ステップ1: 患者情報の整理

患者情報:
[詳細な患者情報]

ガイドライン適用に必要な情報を整理してください。

## ステップ2: 関連ガイドラインの検索（RAG）

以下の最新の診療ガイドラインを参照してください：

[ガイドラインから検索された情報:
- ガイドライン1: [タイトルと内容]
- ガイドライン2: [タイトルと内容]
- ガイドライン3: [タイトルと内容]
]

この患者に適用可能なガイドラインを特定してください。

## ステップ3: ガイドラインの解釈（Chain-of-Thought）

適用可能なガイドラインについて、以下の思考過程で解釈してください：

思考過程:
1. ガイドラインの推奨事項は？
2. この患者は推奨事項の対象に当てはまるか？
3. 当てはまる場合、具体的な推奨事項は？
4. 当てはまらない場合、なぜか？代替案は？

## ステップ4: 患者への適用（Few-shot）

以下の良い適用例を参考に、この患者への適用を検討してください：

良い適用例:
- 患者情報: [情報]
- 適用ガイドライン: [ガイドライン]
- 推奨事項: [推奨事項]
- 適用の根拠: [根拠]
- 注意点: [注意点]

この患者への適用:
- 適用ガイドライン: [ガイドライン]
- 推奨事項: [推奨事項]
- 適用の根拠: [根拠]
- 注意点: [注意点]
- 患者への説明: [説明内容]

## ステップ5: 実践的な推奨事項

ガイドラインの適用結果に基づいて、実践的な推奨事項を提示してください：

1. 推奨される診断アプローチ
2. 推奨される治療
3. フォローアップ計画
4. 患者への説明ポイント
```

## 高度なプロンプト技術の組み合わせ

### 技術の選択指針

1. **Chain-of-Thought**: 複雑な推論が必要な場合
2. **Few-shot Learning**: 特定の形式やパターンが必要な場合
3. **RAG**: 最新情報や専門知識が必要な場合
4. **マルチステップ**: 複数の段階を経る必要がある場合

### 組み合わせの例

```
[RAG] 最新のガイドラインを参照
    ↓
[Chain-of-Thought] ガイドラインを解釈
    ↓
[Few-shot] 類似症例を参照
    ↓
[マルチステップ] 段階的に診断を検討
    ↓
最終的な推奨事項
```

## まとめ

高度なプロンプト技術を組み合わせることで、医療分野の複雑なタスクを効果的に支援できます。各技術の特徴を理解し、タスクに応じて適切に選択・組み合わせることが重要です。実践を通じて、最適なプロンプト設計を習得していきましょう。
