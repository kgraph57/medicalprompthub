> 本ドキュメントは、[Medical AI Research Workflow (MARW)](./marw_workflow.md)の一部です。

# 段階4: データ収集と分析

## 目的

本段階の目的は、策定した研究計画に基づき、研究を遂行し、質の高いデータを収集・分析することです。これは、研究の仮説を検証し、科学的エビデンスを創出する中心的なプロセスです。AIは、データ収集の標準化、統計解析コードの生成、そして結果の可視化を支援し、研究の信頼性と再現性を高めます。

**【最重要警告】実際の患者データを外部のAIツールに入力する際は、各国の個人情報保護法（日本の個人情報保護法、米国のHIPAA、欧州のGDPRなど）を厳格に遵守し、必ずデータを完全に匿名化・非識別化した上で、所属機関の倫理委員会（IRB）の承認を得てください。承認されていないAIツールに機密データを入力することは、重大な倫理違反および法的問題を引き起こす可能性があります。**

## 主要タスク

### 4.1 データ収集と管理

研究の質はデータの質に直結します。体系的で標準化されたデータ収集が不可欠です。

このプロセスでは、人間はデータ収集プロセス全体を監督し、データの品質管理（QC）を行い、臨床的判断が必要なデータの解釈や入力を行う役割を担います。一方、AIは研究プロトコルに基づき、標準化された電子データ収集フォーム（eCRF）の項目を設計し、データ入力規則（バリデーションルール）を提案して入力ミスを減らす役割を果たします。この協働により、高品質なデータ収集が可能になります。

**プロンプト例11: データ収集フォーム（eCRF）の設計**

```
以下の研究計画について、再現性と網羅性を確保した電子データ収集フォーム（eCRF）の項目を提案してください:

- **研究デザイン**: [デザイン名]
- **対象患者**: [患者集団]
- **測定する主要変数**: [変数リスト]

以下のカテゴリーごとに、具体的な項目、データ型（数値、カテゴリー、日付など）、単位、および許容範囲を定義してください:
1. 患者識別情報（匿名化されたID）
2. 人口統計学的情報
3. 既往歴・併存疾患
4. 介入・曝露の詳細
5. 主要・副次アウトカム測定
6. 有害事象

各項目に、データ品質を保証するためのバリデーションルール（例: 年齢は0〜120の整数）を提案してください。
```

### 4.2 データの匿名化とセキュリティ

患者のプライバシー保護は、医療研究における最優先事項です。

このプロセスでは、人間は匿名化計画を策定し、その実施を監督し、再識別リスクを評価し、所属機関のデータセキュリティポリシーを遵守する役割を担います。一方、AIはデータセットに含まれる直接識別子（氏名、ID）および準識別子（郵便番号、生年月日）を特定し、k-匿名化や差分プライバシーなどの匿名化技術に基づいた具体的な処理方法を提案する役割を果たします。この協働により、プライバシーを保護しながらデータの有用性を保つことができます。

**プロンプト例12: データ匿名化計画**

```
以下のデータ項目を含むデータセットを、日本の個人情報保護法および所属機関の規則に準拠して匿名化する方法を提案してください:

[データ項目リスト]

以下の点を考慮した具体的な計画を立案してください:
1. **直接識別子**: どの項目を完全に削除またはハッシュ化するか？
2. **準識別子**: どの項目を一般化（例: 35歳→30代）、トップコーディング、またはランダム化するか？
3. **日付情報**: 日付はどのようにシフトまたは期間に変換するか？
4. **再識別リスクの評価**: 匿名化後のデータセットが、他の情報と結合された場合に個人が再識別されるリスクをどのように評価し、最小化するか？

匿名化によってデータの有用性が損なわれないようにするための対策も併せて提案してください。
```

### 4.3 統計解析

収集したデータを分析し、研究仮説を検証します。AIは、複雑な統計コードの生成を自動化し、研究者が結果の解釈に集中できるようにします。

このプロセスでは、人間は研究質問に答えるための適切な統計解析手法を選択し、AIが生成したコードを検証し、結果を臨床的文脈で解釈する役割を担います。一方、AIは統計解析計画に基づき、R, Python, Stataなどの統計言語で実行可能なコードを生成し、コードには各ステップの目的を説明する詳細なコメントを付与する役割を果たします。この協働により、効率的かつ正確な統計解析が可能になります。

**推奨AIツール**

| ツール | 特徴 | 利用シナリオ |
|:---|:---|:---|
| **ChatGPT/Claude** | コード生成 | 自然言語で指示するだけで、統計解析やデータ可視化のコードを生成。 |
| **GitHub Copilot** | コーディング支援 | RStudioやVSCodeなどのエディタ内で、文脈に応じたコードをリアルタイムに補完・提案。 |

**プロンプト例13: 統計解析コードの生成**

```
以下の統計解析計画について、R言語で実行可能な完全な解析コードを生成してください:

- **研究デザイン**: [デザイン名]
- **データファイル名**: "dataset.csv"
- **主要アウトカム変数**: [変数名]
- **主要曝露/介入変数**: [変数名]
- **調整すべき交絡因子**: [変数名のリスト]

以下の解析ステップを含むコードを、詳細なコメント付きで生成してください:
1. データの読み込みと前処理（欠損値の確認など）
2. 記述統計量の算出とベースライン特性の比較（Table 1作成用）
3. 主要アウトカムの群間比較（適切な統計検定を使用）
4. 多変量解析（例: ロジスティック回帰、Cox比例ハザードモデル）による交絡因子の調整
5. サブグループ解析と感度分析

生成されたコードが、なぜこの研究計画にとって適切なのかを説明してください。
```

### 4.4 データ可視化

分析結果を直感的に理解できるように、図や表を作成します。質の高い可視化は、論文の説得力を大幅に向上させます。

-   **人間の役割**: 論文のメッセージを最も効果的に伝えるための図表の種類（例: フォレストプロット、カプラン・マイヤー曲線）を選択し、その臨床的意味を解釈する。
-   **AIの役割**: 指定された図表の種類に基づき、学術論文の投稿規定（高解像度、グレースケール対応など）に準拠した、カスタマイズ可能な描画コード（例: ggplot2）を生成する。

**プロンプト例14: データ可視化コードの生成**

```
以下の解析結果を可視化するため、Rのggplot2パッケージを使用したコードを生成してください:

[データと解析結果の概要]

以下の学術論文用図表を作成してください:
1. **CONSORTフローダイアグラム**: 患者のスクリーニングから解析対象までの流れを示す。
2. **Table 1**: ベースラインの患者特性を群間で比較する表。
3. **フォレストプロット**: 主要アウトカムおよびサブグループ解析の結果を視覚的に示す。
4. **カプラン・マイヤー曲線**: 生存時間データの群間比較を示す。

すべての図表は、ICMJEの推奨に準拠し、白黒印刷でも判読可能で、軸ラベル、凡例、タイトルが明確なものにしてください。
```

## 成果物

-   **クリーンなデータセット**: 匿名化され、クリーニングが完了した最終解析用データセット。
-   **統計解析結果**: 主要な解析結果をまとめたレポート。
-   **図表**: 投稿準備が整った高品質な図（Figure）と表（Table）。
-   **統計解析コード**: 第三者が解析を完全に再現できる、コメント付きのコードファイル。

## 検証チェックポイント

-   [ ] データは所属機関の規則に従い、適切に匿名化・保護されているか？
-   [ ] 選択した統計手法は、研究デザインとデータの種類に対して適切か？
-   [ ] 多重比較の問題は考慮され、適切に対処されているか？（例: Bonferroni補正）
-   [ ] 欠損データの処理方法（例: 多重代入法）は適切で、その旨が記述されているか？
-   [ ] AIが生成したコードは、人間（可能であれば統計専門家）によって検証され、意図した通りの解析が行われていることが確認されたか？
-   [ ] すべての解析プロセスは、第三者が完全に再現できるように記録されているか？

## AI使用記録テンプレート

```
【段階4: データ収集と分析】

使用ツール: [ツール名、バージョン]
使用目的: [例: 統計コード生成、データ可視化]
主要プロンプト: 
_„„
[使用した主要なプロンプトをここに貼り付け]
“““_
AI出力の検証方法: [例: 生成されたRコードを少量データで実行し、期待通りの結果が得られるか確認。統計専門家によるコードレビュー。]
最終判断: [例: AIが生成したコードをベースに、研究特有の要件に合わせて一部を修正して最終的な解析コードとした。]
```

---

**[◀ 前の段階へ: 段階3: 研究計画とアウトライン作成](./marw_stage3.md) | [▶ 次の段階へ: 段階5: 原稿執筆](./marw_stage5.md)**
