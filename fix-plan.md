# プロンプト入力反映の修正計画

## 問題の根本原因

現在の実装では、テンプレート内のプレースホルダーが`[...]`形式で記述されているが、`PromptDetail.tsx`の`generatePrompt()`関数は`{{key}}`形式のプレースホルダーを置換する仕組みになっている。

```typescript
// PromptDetail.tsx の generatePrompt() 関数
const generatePrompt = () => {
  let content = prompt.template;
  prompt.inputs.forEach((input) => {
    const value = inputValues[input.key] || `[${input.label}]`;
    content = content.replace(new RegExp(`{{${input.key}}}`, "g"), value);
  });
  return content;
};
```

## 修正方針

### オプション1: テンプレートを修正（推奨）
- 全プロンプトのテンプレート内のプレースホルダーを`[...]`から`{{key}}`形式に変更
- inputsの定義を詳細化（主訴、現病歴、既往歴などを個別のフィールドに分離）
- 医学的に標準化された選択肢を追加

### オプション2: generatePrompt()関数を修正
- `[...]`形式のプレースホルダーも認識できるように関数を拡張
- しかし、これでは穴埋め形式の実現が困難

## 実装計画

### Phase 2: 基本的な修正
1. `diagnosis-differential`プロンプトを詳細化
   - 主訴（select: 一般的な症状リスト）
   - 現病歴（textarea）
   - 既往歴（select: 一般的な疾患、複数選択可能）
   - バイタルサイン（構造化入力: 体温、血圧、脈拍、呼吸数、SpO2）

2. テンプレートを`{{key}}`形式に修正

### Phase 3: 全プロンプトへの適用
1. 全100以上のプロンプトを同様に修正
2. 各カテゴリに応じた適切な入力タイプを設定
3. 医学的に標準化された選択肢を追加

## 医学的選択肢の例

### 主訴（一般的な症状）
- 発熱
- 頭痛
- 胸痛
- 腹痛
- 呼吸困難
- 咳嗽
- 嘔気・嘔吐
- 下痢
- めまい
- 意識障害
- その他（自由記載）

### 既往歴（一般的な疾患）
- 高血圧
- 糖尿病
- 脂質異常症
- 心疾患（狭心症、心筋梗塞など）
- 脳血管疾患（脳梗塞、脳出血など）
- 慢性腎臓病
- 肝疾患
- 悪性腫瘍
- 喘息・COPD
- なし
- その他（自由記載）

### バイタルサイン
- 体温（°C）: 数値入力
- 血圧（mmHg）: 収縮期/拡張期
- 脈拍（/分）: 数値入力
- 呼吸数（/分）: 数値入力
- SpO2（%）: 数値入力
