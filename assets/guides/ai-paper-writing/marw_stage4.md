> このドキュメントは、[Medical AI Research Workflow (MARW)](./marw_workflow.md)の一部です。

# ステップ4：データを集め、分析する（研究の実行）

## このステップでやること

設計図が完成したら、いよいよ研究を実行し、データを集めて分析するステップです。ここは、研究の仮説を検証し、新しいエビデンスを生み出す、まさに研究の心臓部です。

このステップでは、AIという優秀なデータアナリストの力を借りて、データ収集の標準化、統計解析コードの自動生成、そして結果の可視化を効率的に進めていきます。

【超重要！プライバシー保護について】

患者さんのデータを扱う時は、個人情報保護法（日本）、HIPAA（米国）、GDPR（欧州）などの法律を絶対に守ってください。外部のAIツールに患者データを入力する場合は、必ずデータを完全に匿名化し、所属機関の倫理委員会（IRB）の承認を得てから行ってください。これを怠ると、重大な倫理違反や法的問題を引き起こす可能性があります。

## 具体的なタスク

### 4.1 データを集める（データ収集と管理）

研究の質は、データの質で決まります。だからこそ、体系的で標準化された方法でデータを集めることが、とても大切です。

- 先生の役割: データ収集のプロセス全体を監督し、データの品質管理（QC）を行い、臨床的な判断が必要な部分（例：「この検査値は、測定ミスの可能性があるな」）を見極める。
- AIの役割: 研究計画に基づいて、標準化された電子データ収集フォーム（eCRF）の項目を設計し、データ入力のミスを減らすためのルール（例：「年齢は0〜120の整数のみ」）を提案してくれる。

【指示書テンプレート⑪】データ収集フォーム（eCRF）を設計する

```
以下の研究計画について、漏れがなく、再現性の高い電子データ収集フォーム（eCRF）の項目を提案してください。

- 研究デザイン: [デザイン名]
- 対象患者: [患者集団]
- 測定する主要変数: [変数リスト]

以下のカテゴリーごとに、具体的な項目、データ型（数値、カテゴリー、日付など）、単位、許容範囲を定義してください。
1. 患者識別情報（匿名化されたID）
2. 人口統計学的情報（年齢、性別など）
3. 既往歴・併存疾患
4. 介入・曝露の詳細
5. 主要・副次アウトカム測定
6. 有害事象

それぞれの項目について、データの質を保つための入力ルール（例：年齢は0〜120の整数のみ）も提案してください。
```

### 4.2 患者さんのプライバシーを守る（データの匿名化とセキュリティ）

患者さんのプライバシー保護は、医療研究における最優先事項です。これは、絶対に妥協してはいけません。

- 先生の役割: 匿名化の計画を立て、その実施を監督し、「このデータから、個人が特定されるリスクはないか？」を評価し、所属機関のルールを守る。
- AIの役割: データセットに含まれる「氏名」や「ID」といった直接識別子、そして「郵便番号」や「生年月日」といった準識別子を見つけ出し、k-匿名化や差分プライバシーといった技術を使った具体的な処理方法を提案してくれる。

【指示書テンプレート⑫】データ匿名化計画を立てる

```
以下のデータ項目を含むデータセットを、日本の個人情報保護法および所属機関の規則に準拠して匿名化する方法を提案してください。

[データ項目リスト]

以下の点を考慮した具体的な計画を立ててください。
1. 直接識別子: どの項目を完全に削除、またはハッシュ化するか？
2. 準識別子: どの項目を一般化（例：35歳→30代）、トップコーディング、またはランダム化するか？
3. 日付情報: 日付はどのようにシフト、または期間に変換するか？
4. 再識別リスクの評価: 匿名化後のデータが、他の情報と結合された場合に、個人が再識別されるリスクをどう評価し、最小化するか？

匿名化によって、データの有用性が損なわれないようにするための対策も、併せて提案してください。
```

### 4.3 データを分析する（統計解析）

集めたデータを分析して、研究の仮説を検証します。ここで、AIは複雑な統計コードの生成を自動化してくれるので、先生は結果の解釈に集中できます。

- 先生の役割: 研究の「問い」に答えるために、どんな統計手法を使うべきか選択し、AIが生成したコードが正しいか検証し、結果を臨床的な文脈で解釈する。
- AIの役割: 統計解析の計画に基づいて、R、Python、Stataなどの統計言語で実行可能なコードを生成し、コードの各ステップに「ここで何をやっているか」を説明するコメントをつけてくれる。

おすすめのAIアシスタント

| ツール | 特徴 | こんな時に便利！ |
|:---|:---|:---|
| ChatGPT/Claude | コード生成 | 「こういう分析をしたいんだけど」と自然な言葉で指示するだけで、統計コードを書いてくれる。 |
| GitHub Copilot | コーディング支援 | RStudioやVSCodeなどのエディタで、文脈に応じたコードをリアルタイムに補完・提案してくれる。 |

【指示書テンプレート⑬】統計解析コードを生成する

```
以下の統計解析計画について、R言語で実行可能な完全な解析コードを生成してください。

- 研究デザイン: [デザイン名]
- データファイル名: "dataset.csv"
- 主要アウトカム変数: [変数名]
- 主要曝露/介入変数: [変数名]
- 調整すべき交絡因子: [変数名のリスト]

以下の解析ステップを含むコードを、詳しいコメント付きで生成してください。
1. データの読み込みと前処理（欠損値の確認など）
2. 記述統計量の算出とベースライン特性の比較（Table 1作成用）
3. 主要アウトカムの群間比較（適切な統計検定を使用）
4. 多変量解析（例：ロジスティック回帰、Cox比例ハザードモデル）による交絡因子の調整
5. サブグループ解析と感度分析

なぜこのコードが、この研究計画にとって適切なのか、理由も説明してください。
```

### 4.4 結果を「見える化」する（データ可視化）

分析結果を、誰が見ても直感的に理解できるように、図や表にします。質の高い図表は、論文の説得力を大きく高めます。

- 先生の役割: 論文のメッセージを最も効果的に伝えるために、どんな図表（例：フォレストプロット、カプラン・マイヤー曲線）を使うべきか選び、その臨床的な意味を解釈する。
- AIの役割: 先生が指定した図表の種類に基づいて、学術論文の投稿規定（高解像度、白黒印刷でも見やすいなど）に準拠した、カスタマイズ可能な描画コード（例：ggplot2）を生成してくれる。

【指示書テンプレート⑭】データ可視化コードを生成する

```
以下の解析結果を可視化するため、Rのggplot2パッケージを使用したコードを生成してください。

[データと解析結果の概要]

以下の学術論文用図表を作成してください。
1. CONSORTフローダイアグラム: 患者のスクリーニングから解析対象までの流れを示す。
2. Table 1: ベースラインの患者特性を群間で比較する表。
3. フォレストプロット: 主要アウトカムおよびサブグループ解析の結果を視覚的に示す。
4. カプラン・マイヤー曲線: 生存時間データの群間比較を示す。

すべての図表は、ICMJEの推奨に準拠し、白黒印刷でも判読可能で、軸ラベル、凡例、タイトルが明確なものにしてください。
```

## このステップのゴール

- クリーンなデータセット: 匿名化され、クリーニングが完了した、最終解析用のデータセット。
- 統計解析結果: 主要な解析結果をまとめたレポート。
- 図表: 投稿準備が整った、高品質な図（Figure）と表（Table）。
- 統計解析コード: 第三者が解析を完全に再現できる、コメント付きのコードファイル。

## 次に進む前のチェックリスト

- [ ] データは、所属機関の規則に従って、適切に匿名化・保護されているか？
- [ ] 選んだ統計手法は、研究デザインとデータの種類に対して適切か？
- [ ] 多重比較の問題は考慮され、適切に対処されているか？（例：Bonferroni補正）
- [ ] 欠損データの処理方法（例：多重代入法）は適切で、その旨が記述されているか？
- [ ] AIが生成したコードは、人間（できれば統計の専門家）によって検証され、意図した通りの解析が行われていることが確認されたか？
- [ ] すべての解析プロセスは、第三者が完全に再現できるように記録されているか？

## AI活用記録

```
【ステップ4：データ収集と分析】

使用ツール: [ツール名、バージョン]
目的: [例: 統計コード生成、データ可視化]

使った主な指示書（プロンプト）:
"""
[ここに、実際に使った指示書を貼り付ける]
"""

AIの答えをどう検証したか: [例: 生成されたRコードを少量データで実行し、期待通りの結果が得られるか確認した。統計専門家によるコードレビューも実施した]
最終的にどう判断したか: [例: AIが生成したコードをベースに、研究特有の要件に合わせて一部を修正して、最終的な解析コードとした]
```

---

[◀ 前のステップへ: ステップ3：研究の設計図を描く](./marw_stage3.md) | [▶ 次のステップへ: ステップ5：物語を紡ぐ（論文執筆）](./marw_stage5.md)
